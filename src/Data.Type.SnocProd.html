<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs                #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE InstanceSigs         #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE KindSignatures       #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase           #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables  #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell      #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE TypeApplications     #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies         #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE TypeInType           #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE TypeOperators        #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">SnocProd</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Kind</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Proxy</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Length</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Length.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Length</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCL</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Product</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Product.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Product</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span class="hs-operator">.</span><span class="hs-identifier">Witness</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Family</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><a href="Type.Family.List.Util.html"><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Family</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-keyword">data</span><span> </span><a name="SnocProd"><a href="Data.Type.SnocProd.html#SnocProd"><span class="hs-identifier">SnocProd</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627720338"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1627720338"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-26"></a><span>    </span><a name="%D8S"><a href="Data.Type.SnocProd.html#%D8S"><span class="hs-identifier">&#216;S</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Data.Type.SnocProd.html#SnocProd"><span class="hs-identifier hs-type">SnocProd</span></a><span> </span><a href="#local-1627720339"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-char">'[]
    (:&amp;) :: SnocProd f as -&gt; f a -&gt; SnocProd f (as &gt;: a)

snocProdHelp
    :: forall f as bs. ()
    =&gt; Length bs
    -&gt; SnocProd f bs
    -&gt; Length as
    -&gt; Prod f as
    -&gt; SnocProd f (bs ++ as)
snocProdHelp lB sB = \case
    LZ     -&gt; \case
      &#216;                -&gt; sB \\ appendNil lB
    LS lA' -&gt; \case
      (x :: f a) :&lt; xs -&gt; snocProdHelp (lB TCL.&gt;: Proxy @a) (sB :&amp; x) lA' xs
                            \\ appendSnoc lB (Proxy @a)
                            \\ appendAssoc lB (LS LZ :: Length '[a]) lA'

snocProd
    :: Prod f as
    -&gt; SnocProd f as
snocProd p = snocProdHelp LZ &#216;S (prodLength p) p

snocProdLength
    :: SnocProd f as
    -&gt; Length as
snocProdLength = \case
    &#216;S               -&gt; LZ
    ss :&amp; (_ :: f a) -&gt; snocProdLength ss TCL.&gt;: Proxy @a

snocProdReverse
    :: SnocProd f as
    -&gt; Prod f (Reverse as)
snocProdReverse = \case
    &#216;S      -&gt; &#216;
    ss :&amp; s -&gt; s :&lt; snocProdReverse ss
                 \\ snocReverse (snocProdLength ss) s
-- TODO: might recomputing snocProdLength be slow?

reverseSnocProd
    :: Prod f as
    -&gt; SnocProd f (Reverse as)
reverseSnocProd = \case
    &#216;       -&gt; &#216;S
    x :&lt; xs -&gt; reverseSnocProd xs :&amp; x

-- | An implementation of reverse' for Prod that runs in O(n) instead of
-- O(n^2)
prodReverse'
    :: Prod f as
    -&gt; Prod f (Reverse as)
prodReverse' = snocProdReverse . snocProd


</span></pre></body></html>