<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds        #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DataKinds              #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE DeriveFoldable         #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE DeriveFunctor          #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE DeriveTraversable      #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts       #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances      #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE GADTs                  #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE InstanceSigs           #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE KindSignatures         #-}</span><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase             #-}</span><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses  #-}</span><span>
</span><a name="line-14"></a><span class="hs-pragma">{-# LANGUAGE PolyKinds              #-}</span><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables    #-}</span><span>
</span><a name="line-16"></a><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving     #-}</span><span>
</span><a name="line-17"></a><span class="hs-pragma">{-# LANGUAGE TypeApplications       #-}</span><span>
</span><a name="line-18"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies           #-}</span><span>
</span><a name="line-19"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilyDependencies #-}</span><span>
</span><a name="line-20"></a><span class="hs-pragma">{-# LANGUAGE TypeInType             #-}</span><span>
</span><a name="line-21"></a><span class="hs-pragma">{-# LANGUAGE TypeOperators          #-}</span><span>
</span><a name="line-22"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances   #-}</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Nested</span><span>
</span><a name="line-25"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Data.Nested.html#Vec"><span class="hs-identifier hs-type">Vec</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nesting"><span class="hs-identifier hs-type">Nesting</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#nesting1Every"><span class="hs-identifier hs-var">nesting1Every</span></a><span>
</span><a name="line-28"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span>
</span><a name="line-29"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#genNested"><span class="hs-identifier hs-var">genNested</span></a><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#genNestedA"><span class="hs-identifier hs-var">genNestedA</span></a><span>
</span><a name="line-30"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#indexNested"><span class="hs-identifier hs-var">indexNested</span></a><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#indexNested%27"><span class="hs-identifier hs-var">indexNested'</span></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#transpose"><span class="hs-identifier hs-var">transpose</span></a><span>
</span><a name="line-32"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#transpose%27"><span class="hs-identifier hs-var">transpose'</span></a><span>
</span><a name="line-33"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#gmul%27"><span class="hs-identifier hs-var">gmul'</span></a><span>
</span><a name="line-34"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#diagNV"><span class="hs-identifier hs-var">diagNV</span></a><span>
</span><a name="line-35"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#joinNested"><span class="hs-identifier hs-var">joinNested</span></a><span>
</span><a name="line-36"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#nIxRows"><span class="hs-identifier hs-var">nIxRows</span></a><span>
</span><a name="line-37"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#vGen"><span class="hs-identifier hs-var">vGen</span></a><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#itraverseNested"><span class="hs-identifier hs-var">itraverseNested</span></a><span>
</span><a name="line-38"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#liftNested"><span class="hs-identifier hs-var">liftNested</span></a><span>
</span><a name="line-39"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#unScalar"><span class="hs-identifier hs-var">unScalar</span></a><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#unNest"><span class="hs-identifier hs-var">unNest</span></a><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#unVector"><span class="hs-identifier hs-var">unVector</span></a><span>
</span><a name="line-40"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-comment">-- import           Data.Type.Product.Util</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">DeepSeq</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Distributive</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Kind</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Singletons</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Singletons</span><span class="hs-operator">.</span><span class="hs-identifier">Prelude</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Length</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Reverse</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">%:++</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sReverse</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Combinator</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Combinator.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Combinator</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Index</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Length</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCL</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Length.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Length</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>               </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCL</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Product</span><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCP</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Product.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Product</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>              </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCP</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Sing.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Sing</span></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.SnocProd.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">SnocProd</span></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Uniform.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Uniform</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span>           </span><a href="TensorOps.NatKind.html"><span class="hs-identifier">TensorOps</span><span class="hs-operator">.</span><span class="hs-identifier">NatKind</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span class="hs-operator">.</span><span class="hs-identifier">Witness</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Family</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span>           </span><a href="Type.Family.List.Util.html"><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Family</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Singletons</span><span class="hs-operator">.</span><span class="hs-identifier">TypeLits</span><span>            </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GT</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Nat</span><span>                       </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCN</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCV</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.Type.Vector.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>               </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCV</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.Vector.Sized.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span class="hs-operator">.</span><span class="hs-identifier">Sized</span></a><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">VS</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-keyword">data</span><span> </span><a name="Uncons"><a href="Data.Nested.html#Uncons"><span class="hs-identifier">Uncons</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627586739"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586739"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-71"></a><span>    </span><a name="UNil"><a href="Data.Nested.html#UNil"><span class="hs-identifier">UNil</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Data.Nested.html#Uncons"><span class="hs-identifier hs-type">Uncons</span></a><span> </span><a href="#local-1627586740"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#FromNat"><span class="hs-identifier hs-type">FromNat</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-1627586741"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-72"></a><span>    </span><a name="UCons"><a href="Data.Nested.html#UCons"><span class="hs-identifier">UCons</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Sing</span><span> </span><a href="#local-1627586742"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">!</span><a href="#local-1627586743"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="#local-1627586744"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586742"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-1627586743"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#Uncons"><span class="hs-identifier hs-type">Uncons</span></a><span> </span><a href="#local-1627586744"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#Succ"><span class="hs-identifier hs-type">Succ</span></a><span> </span><a href="#local-1627586742"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627586743"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-keyword">class</span><span> </span><a href="TensorOps.NatKind.html#NatKind"><span class="hs-identifier hs-type">NatKind</span></a><span> </span><a href="#local-1627586718"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="Vec"><a href="Data.Nested.html#Vec"><span class="hs-identifier">Vec</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627586719"><a href="#local-1627586719"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586718"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-75"></a><span>    </span><span class="hs-identifier">vHead</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586720"><span class="hs-identifier hs-type">p</span></a><span> </span><a href="#local-1627586721"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586719"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#Succ"><span class="hs-identifier hs-type">Succ</span></a><span> </span><a href="#local-1627586721"><span class="hs-identifier hs-type">j</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627586722"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586722"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-76"></a><span>    </span><span class="hs-identifier">vTail</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586719"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#Succ"><span class="hs-identifier hs-type">Succ</span></a><span> </span><a href="#local-1627586723"><span class="hs-identifier hs-type">j</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627586724"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586719"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586723"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627586724"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-77"></a><span>    </span><span class="hs-identifier">vGenA</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-1627586725"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><a href="#local-1627586726"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#IndexN"><span class="hs-identifier hs-type">IndexN</span></a><span> </span><a href="#local-1627586718"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627586726"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586725"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-1627586727"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586725"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627586719"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586726"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627586727"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>    </span><span class="hs-identifier">vIndex</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TensorOps.NatKind.html#IndexN"><span class="hs-identifier hs-type">IndexN</span></a><span> </span><a href="#local-1627586718"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627586728"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586719"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586728"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627586729"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586729"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-79"></a><span>    </span><span class="hs-identifier">vUncons</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><a href="#local-1627586730"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586719"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586730"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627586731"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#Uncons"><span class="hs-identifier hs-type">Uncons</span></a><span> </span><a href="#local-1627586719"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586730"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627586731"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-80"></a><span>    </span><span class="hs-identifier">vEmpty</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586719"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#FromNat"><span class="hs-identifier hs-type">FromNat</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-1627586732"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-81"></a><span>    </span><span class="hs-identifier">vCons</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586733"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586719"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586734"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627586733"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586719"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#Succ"><span class="hs-identifier hs-type">Succ</span></a><span> </span><a href="#local-1627586734"><span class="hs-identifier hs-type">j</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627586733"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-82"></a><span>    </span><span class="hs-identifier">vITraverse</span><span>
</span><a name="line-83"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-1627586735"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-84"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#IndexN"><span class="hs-identifier hs-type">IndexN</span></a><span> </span><a href="#local-1627586718"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627586736"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586737"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586735"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-1627586738"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586719"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586736"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627586737"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-86"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586735"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627586719"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586736"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627586738"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-identifier">vGen</span><span>
</span><a name="line-89"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Data.Nested.html#Vec"><span class="hs-identifier hs-type">Vec</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627586847"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586849"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><a href="#local-1627586848"><span class="hs-identifier hs-type">j</span></a><span>
</span><a name="line-91"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#IndexN"><span class="hs-identifier hs-type">IndexN</span></a><span> </span><a href="#local-1627586849"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627586848"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586850"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586847"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586848"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627586850"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-93"></a><a name="vGen"><a href="Data.Nested.html#vGen"><span class="hs-identifier">vGen</span></a></a><span> </span><a name="local-1627586851"><a href="#local-1627586851"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627586852"><a href="#local-1627586852"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getI</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Nested.html#vGenA"><span class="hs-identifier hs-var">vGenA</span></a><span> </span><a href="#local-1627586851"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627586852"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span class="hs-pragma">{-# INLINE vGen #-}</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.Nested.html#Vec"><span class="hs-identifier hs-type">Vec</span></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><span class="hs-identifier hs-type">I</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-97"></a><span>    </span><a name="local-1912799334"><a href="Data.Nested.html#vHead"><span class="hs-identifier">vHead</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getI</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Vector.Sized.html#head"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">head</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getFlip2</span><span>
</span><a name="line-98"></a><span>    </span><span class="hs-pragma">{-# INLINE vHead #-}</span><span>
</span><a name="line-99"></a><span>    </span><a name="local-1912799335"><a href="Data.Nested.html#vTail"><span class="hs-identifier">vTail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Vector.Sized.html#tail"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">tail</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getFlip2</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-pragma">{-# INLINE vTail #-}</span><span>
</span><a name="line-101"></a><span>    </span><a name="local-1912799336"><a href="Data.Nested.html#vGenA"><span class="hs-identifier">vGenA</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-102"></a><span>      </span><span class="hs-identifier hs-var">GT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">SNat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Vector.Sized.html#generateA"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generateA</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">I</span><span> </span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-pragma">{-# INLINE vGenA #-}</span><span>
</span><a name="line-104"></a><span>    </span><a name="local-1912799337"><a href="Data.Nested.html#vIndex"><span class="hs-identifier">vIndex</span></a></a><span> </span><a name="local-1627587028"><a href="#local-1627587028"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Vector.Sized.html#%21%21"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.!!</span></a><span> </span><a href="#local-1627587028"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getFlip2</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-pragma">{-# INLINE vIndex #-}</span><span>
</span><a name="line-106"></a><span>    </span><a name="local-1912799338"><a href="Data.Nested.html#vUncons"><span class="hs-identifier">vUncons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-107"></a><span>      </span><span class="hs-identifier hs-var">GT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">SNat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-108"></a><span>        </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a name="local-1627587029"><a href="#local-1627587029"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Data.Vector.Sized.html#uncons"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">uncons</span></a><span> </span><a href="#local-1627587029"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-109"></a><span>          </span><a href="Data.Vector.Sized.html#VNil"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">VNil</span></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#UNil"><span class="hs-identifier hs-var">UNil</span></a><span>
</span><a name="line-110"></a><span>          </span><a href="Data.Vector.Sized.html#VCons"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">VCons</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><a name="local-1627587030"><a href="#local-1627587030"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627587031"><a href="#local-1627587031"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#UCons"><span class="hs-identifier hs-var">UCons</span></a><span> </span><span class="hs-identifier hs-var">sing</span><span> </span><a href="#local-1627587030"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a href="#local-1627587031"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span>    </span><span class="hs-pragma">{-# INLINE vUncons #-}</span><span>
</span><a name="line-112"></a><span>    </span><a name="local-1912799339"><a href="Data.Nested.html#vEmpty"><span class="hs-identifier">vEmpty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#empty"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-113"></a><span>    </span><span class="hs-pragma">{-# INLINE vEmpty #-}</span><span>
</span><a name="line-114"></a><span>    </span><a name="local-1912799340"><a href="Data.Nested.html#vCons"><span class="hs-identifier">vCons</span></a></a><span> </span><a name="local-1627587032"><a href="#local-1627587032"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a name="local-1627587033"><a href="#local-1627587033"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-special">(</span><a href="Data.Vector.Sized.html#cons"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">cons</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><a href="#local-1627587032"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627587033"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-pragma">{-# INLINE vCons #-}</span><span>
</span><a name="line-116"></a><span>    </span><a name="local-1912799341"><a href="Data.Nested.html#vITraverse"><span class="hs-identifier">vITraverse</span></a></a><span> </span><a name="local-1627587034"><a href="#local-1627587034"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a name="local-1627587035"><a href="#local-1627587035"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Data.Vector.Sized.html#itraverse"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">itraverse</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627587036"><a href="#local-1627587036"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><a name="local-1627587037"><a href="#local-1627587037"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">I</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627587034"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627587036"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627587037"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627587035"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-117"></a><span>    </span><span class="hs-pragma">{-# INLINE vITraverse #-}</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.Nested.html#Vec"><span class="hs-identifier hs-type">Vec</span></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><span class="hs-identifier hs-type">I</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-120"></a><span>    </span><a name="local-1912799334"><a href="Data.Nested.html#vHead"><span class="hs-identifier">vHead</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getI</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">head'</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getFlip2</span><span>
</span><a name="line-121"></a><span>    </span><span class="hs-pragma">{-# INLINE vHead #-}</span><span>
</span><a name="line-122"></a><span>    </span><a name="local-1912799335"><a href="Data.Nested.html#vTail"><span class="hs-identifier">vTail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">tail'</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getFlip2</span><span>
</span><a name="line-123"></a><span>    </span><span class="hs-pragma">{-# INLINE vTail #-}</span><span>
</span><a name="line-124"></a><span>    </span><a name="local-1912799336"><a href="Data.Nested.html#vGenA"><span class="hs-identifier">vGenA</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-125"></a><span>      </span><a href="Data.Type.Sing.html#SN"><span class="hs-identifier hs-var">SN</span></a><span> </span><a name="local-1627587016"><a href="#local-1627587016"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><a name="local-1627587017"><a href="#local-1627587017"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Data.Type.Vector.Util.html#vgenA"><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">vgenA</span></a><span> </span><a href="#local-1627587016"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">I</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627587017"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>    </span><span class="hs-pragma">{-# INLINE vGenA #-}</span><span>
</span><a name="line-127"></a><span>    </span><a name="local-1912799337"><a href="Data.Nested.html#vIndex"><span class="hs-identifier">vIndex</span></a></a><span> </span><a name="local-1627587018"><a href="#local-1627587018"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">index'</span><span> </span><a href="#local-1627587018"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getFlip2</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-pragma">{-# INLINE vIndex #-}</span><span>
</span><a name="line-129"></a><span>    </span><a name="local-1912799338"><a href="Data.Nested.html#vUncons"><span class="hs-identifier">vUncons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-130"></a><span>      </span><a href="Data.Type.Sing.html#SN"><span class="hs-identifier hs-var">SN</span></a><span> </span><span class="hs-identifier hs-var">TCN</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Z_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-131"></a><span>        </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">&#216;V</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#UNil"><span class="hs-identifier hs-var">UNil</span></a><span>
</span><a name="line-132"></a><span>      </span><a href="Data.Type.Sing.html#SN"><span class="hs-identifier hs-var">SN</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TCN</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">S_</span><span> </span><a name="local-1627587019"><a href="#local-1627587019"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-133"></a><span>        </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><a name="local-1627587020"><a href="#local-1627587020"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.:*</span><span> </span><a name="local-1627587021"><a href="#local-1627587021"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#UCons"><span class="hs-identifier hs-var">UCons</span></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Sing.html#SN"><span class="hs-identifier hs-var">SN</span></a><span> </span><a href="#local-1627587019"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627587020"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a href="#local-1627587021"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-pragma">{-# INLINE vUncons #-}</span><span>
</span><a name="line-135"></a><span>    </span><a name="local-1912799339"><a href="Data.Nested.html#vEmpty"><span class="hs-identifier">vEmpty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">&#216;V</span><span>
</span><a name="line-136"></a><span>    </span><span class="hs-pragma">{-# INLINE vEmpty #-}</span><span>
</span><a name="line-137"></a><span>    </span><a name="local-1912799340"><a href="Data.Nested.html#vCons"><span class="hs-identifier">vCons</span></a></a><span> </span><a name="local-1627587022"><a href="#local-1627587022"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a name="local-1627587023"><a href="#local-1627587023"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><a href="#local-1627587022"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.:*</span><span> </span><a href="#local-1627587023"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>    </span><span class="hs-pragma">{-# INLINE vCons #-}</span><span>
</span><a name="line-139"></a><span>    </span><a name="local-1912799341"><a href="Data.Nested.html#vITraverse"><span class="hs-identifier">vITraverse</span></a></a><span> </span><a name="local-1627587024"><a href="#local-1627587024"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a name="local-1627587025"><a href="#local-1627587025"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">itraverse</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627587026"><a href="#local-1627587026"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><a name="local-1627587027"><a href="#local-1627587027"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">I</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627587024"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627587026"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627587027"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627587025"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-140"></a><span>    </span><span class="hs-pragma">{-# INLINE vITraverse #-}</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-keyword">class</span><span> </span><a name="Nesting"><a href="Data.Nested.html#Nesting"><span class="hs-identifier">Nesting</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627586712"><a href="#local-1627586712"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586711"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627586714"><a href="#local-1627586714"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586713"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627586715"><a href="#local-1627586715"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586711"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586713"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586713"><span class="hs-identifier hs-type">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-143"></a><span>    </span><span class="hs-identifier">nesting</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586712"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627586716"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586714"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-1627586717"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-operator">:-</span><span> </span><a href="#local-1627586714"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627586715"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586716"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-1627586717"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span class="hs-keyword">class</span><span> </span><a name="Nesting1"><a href="Data.Nested.html#Nesting1"><span class="hs-identifier">Nesting1</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627586706"><a href="#local-1627586706"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586705"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627586708"><a href="#local-1627586708"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586707"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627586709"><a href="#local-1627586709"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586705"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627586707"><span class="hs-identifier hs-type">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-146"></a><span>    </span><span class="hs-identifier">nesting1</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586706"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627586710"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Wit</span><span> </span><span class="hs-special">(</span><a href="#local-1627586708"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627586709"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586710"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.Nested.html#Nesting"><span class="hs-identifier hs-type">Nesting</span></a><span> </span><a href="#local-1627587015"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><span class="hs-identifier hs-type">I</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-149"></a><span>    </span><a name="local-1912799332"><a href="Data.Nested.html#nesting"><span class="hs-identifier">nesting</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Sub</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-150"></a><span>    </span><span class="hs-pragma">{-# INLINE nesting #-}</span><span>
</span><a name="line-151"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-1627587013"><span class="hs-identifier hs-type">f</span></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627587014"><span class="hs-identifier hs-type">w</span></a><span>    </span><span class="hs-identifier hs-type">Functor</span><span>      </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><a href="#local-1627587013"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-152"></a><span>    </span><a name="local-1912799330"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-153"></a><span>    </span><span class="hs-pragma">{-# INLINE nesting1 #-}</span><span>
</span><a name="line-154"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-1627587012"><span class="hs-identifier hs-type">f</span></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span>  </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><a href="#local-1627587012"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-155"></a><span>    </span><a name="local-1912799330"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier hs-var">GT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">SNat</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-156"></a><span>    </span><span class="hs-pragma">{-# INLINE nesting1 #-}</span><span>
</span><a name="line-157"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span> </span><a href="#local-1627587010"><span class="hs-identifier hs-type">f</span></a><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627587011"><span class="hs-identifier hs-type">w</span></a><span>    </span><span class="hs-identifier hs-type">Foldable</span><span>     </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><a href="#local-1627587010"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-158"></a><span>    </span><a name="local-1912799330"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-159"></a><span>    </span><span class="hs-pragma">{-# INLINE nesting1 #-}</span><span>
</span><a name="line-160"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span> </span><a href="#local-1627587008"><span class="hs-identifier hs-type">f</span></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627587009"><span class="hs-identifier hs-type">w</span></a><span>    </span><span class="hs-identifier hs-type">Traversable</span><span>  </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><a href="#local-1627587008"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-161"></a><span>    </span><a name="local-1912799330"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-162"></a><span>    </span><span class="hs-pragma">{-# INLINE nesting1 #-}</span><span>
</span><a name="line-163"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Distributive</span><span> </span><a href="#local-1627587007"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><span class="hs-identifier hs-type">Distributive</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><a href="#local-1627587007"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-164"></a><span>    </span><a name="local-1912799330"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier hs-var">GT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">SNat</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-165"></a><span>    </span><span class="hs-pragma">{-# INLINE nesting1 #-}</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.Nested.html#Nesting"><span class="hs-identifier hs-type">Nesting</span></a><span> </span><a href="#local-1627587006"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><span class="hs-identifier hs-type">I</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-169"></a><span>    </span><a name="local-1912799332"><a href="Data.Nested.html#nesting"><span class="hs-identifier">nesting</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Sub</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-170"></a><span>    </span><span class="hs-pragma">{-# INLINE nesting #-}</span><span>
</span><a name="line-171"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-1627587004"><span class="hs-identifier hs-type">f</span></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627587005"><span class="hs-identifier hs-type">w</span></a><span>    </span><span class="hs-identifier hs-type">Functor</span><span>      </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><a href="#local-1627587004"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-172"></a><span>    </span><a name="local-1912799330"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-173"></a><span>    </span><span class="hs-pragma">{-# INLINE nesting1 #-}</span><span>
</span><a name="line-174"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-1627587002"><span class="hs-identifier hs-type">f</span></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span>  </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><a href="#local-1627587002"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-175"></a><span>    </span><a name="local-1912799330"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Sing.html#SN"><span class="hs-identifier hs-var">SN</span></a><span> </span><a name="local-1627587003"><a href="#local-1627587003"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span> </span><span class="hs-operator hs-var">\\</span><span> </span><a href="#local-1627587003"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-176"></a><span>    </span><span class="hs-pragma">{-# INLINE nesting1 #-}</span><span>
</span><a name="line-177"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span> </span><a href="#local-1627587000"><span class="hs-identifier hs-type">f</span></a><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627587001"><span class="hs-identifier hs-type">w</span></a><span>    </span><span class="hs-identifier hs-type">Foldable</span><span>     </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><a href="#local-1627587000"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-178"></a><span>    </span><a name="local-1912799330"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-179"></a><span>    </span><span class="hs-pragma">{-# INLINE nesting1 #-}</span><span>
</span><a name="line-180"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span> </span><a href="#local-1627586998"><span class="hs-identifier hs-type">f</span></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627586999"><span class="hs-identifier hs-type">w</span></a><span>    </span><span class="hs-identifier hs-type">Traversable</span><span>  </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><a href="#local-1627586998"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-181"></a><span>    </span><a name="local-1912799330"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-182"></a><span>    </span><span class="hs-pragma">{-# INLINE nesting1 #-}</span><span>
</span><a name="line-183"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Distributive</span><span> </span><a href="#local-1627586996"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><span class="hs-identifier hs-type">Distributive</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><a href="#local-1627586996"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-184"></a><span>    </span><a name="local-1912799330"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Sing.html#SN"><span class="hs-identifier hs-var">SN</span></a><span> </span><a name="local-1627586997"><a href="#local-1627586997"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span> </span><span class="hs-operator hs-var">\\</span><span> </span><a href="#local-1627586997"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-185"></a><span>    </span><span class="hs-pragma">{-# INLINE nesting1 #-}</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-identifier">nesting1Every</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627586841"><a href="#local-1627586841"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627586842"><a href="#local-1627586842"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-1627586843"><a href="#local-1627586843"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-1627586844"><a href="#local-1627586844"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-keyword">as</span><span class="hs-operator">.</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627586842"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627586843"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-1627586844"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-189"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627586841"><span class="hs-identifier hs-type">p</span></a><span> </span><a href="#local-1627586844"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-190"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Prod</span><span> </span><a href="#local-1627586842"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-191"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Wit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Every</span><span> </span><a href="#local-1627586843"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627586844"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-192"></a><a name="nesting1Every"><a href="Data.Nested.html#nesting1Every"><span class="hs-identifier">nesting1Every</span></a></a><span> </span><a name="local-1627586853"><a href="#local-1627586853"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-193"></a><span>    </span><span class="hs-identifier hs-var">&#216;</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-194"></a><span>    </span><span class="hs-special">(</span><a name="local-1627586855"><a href="#local-1627586855"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627586842"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627586854"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">:&lt;</span><span> </span><span class="hs-special">(</span><a name="local-1627586857"><a href="#local-1627586857"><span class="hs-identifier">ws</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Prod</span><span> </span><a href="#local-1627586842"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627586856"><span class="hs-identifier hs-type">as'</span></a><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>  </span><span class="hs-operator hs-var">\\</span><span> </span><span class="hs-special">(</span><a href="Data.Nested.html#nesting1"><span class="hs-identifier hs-var">nesting1</span></a><span> </span><a href="#local-1627586855"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Wit</span><span> </span><span class="hs-special">(</span><a href="#local-1627586843"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627586844"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627586854"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>                </span><span class="hs-operator hs-var">\\</span><span> </span><span class="hs-special">(</span><a href="Data.Nested.html#nesting1Every"><span class="hs-identifier hs-var">nesting1Every</span></a><span> </span><a href="#local-1627586853"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627586857"><span class="hs-identifier hs-var">ws</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Wit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Every</span><span> </span><a href="#local-1627586843"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627586844"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><a href="#local-1627586856"><span class="hs-identifier hs-type">as'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-197"></a><span class="hs-pragma">{-# INLINE nesting1Every #-}</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-keyword">data</span><span> </span><a name="Nested"><a href="Data.Nested.html#Nested"><span class="hs-identifier">Nested</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627586698"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1627586698"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-200"></a><span>    </span><a name="N%D8"><a href="Data.Nested.html#N%D8"><span class="hs-identifier">N&#216;</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="#local-1627586699"><span class="hs-identifier hs-type">a</span></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627586700"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-char">'[]       a
    NS :: !(v j (Nested v js a)) -&gt; Nested v (j ': js) a

instance (NFData a, Nesting Proxy NFData v) =&gt; NFData (Nested v js a) where
    rnf = \case
      N&#216; x  -&gt; deepseq x  ()
      NS (xs :: v j (Nested v ks a))
            -&gt; deepseq xs ()
                 \\ (nesting Proxy :: NFData (Nested v ks a) :- NFData (v j (Nested v ks a)))
    {-# INLINE rnf #-}

-- deriving instance ListC (Show &lt;$&gt; ((v &lt;$&gt; js) &lt;&amp;&gt; a)) =&gt; Show (Nested v js a)

instance (Num a, Applicative (Nested v js)) =&gt; Num (Nested v js a) where
    (+)         = liftA2 (+)
    {-# INLINE (+) #-}
    (*)         = liftA2 (*)
    {-# INLINE (*) #-}
    (-)         = liftA2 (-)
    {-# INLINE (-) #-}
    negate      = fmap negate
    {-# INLINE negate #-}
    abs         = fmap abs
    {-# INLINE abs #-}
    signum      = fmap signum
    {-# INLINE signum #-}
    fromInteger = pure . fromInteger
    {-# INLINE fromInteger #-}

instance Nesting1 Proxy Functor v =&gt; Functor (Nested v js) where
    fmap f = \case
      N&#216; x  -&gt; N&#216; (f x)
      NS (xs :: v j (Nested v ks a))
            -&gt; NS $ (fmap.fmap) f xs
                      \\ (nesting1 Proxy :: Wit (Functor (v j)))

instance (SingI js, Nesting1 Sing Applicative v, Nesting1 Proxy Functor v) =&gt; Applicative (Nested v js) where
    pure :: forall a. a -&gt; Nested v js a
    pure x = go sing
      where
        go  :: Sing ks
            -&gt; Nested v ks a
        go = \case
          SNil     -&gt; N&#216; x
          (s :: Sing k) `SCons` ss -&gt; NS (pure (go ss))
                    \\ (nesting1 s :: Wit (Applicative (v k)))
    {-# INLINE pure #-}
    (&lt;*&gt;) :: forall a b. Nested v js (a -&gt; b) -&gt; Nested v js a -&gt; Nested v js b
    (&lt;*&gt;) = go sing
      where
        go  :: Sing ks
            -&gt; Nested v ks (a -&gt; b)
            -&gt; Nested v ks a
            -&gt; Nested v ks b
        go = \case
          SNil -&gt; \case
            N&#216; f -&gt; \case
              N&#216; x -&gt; N&#216; (f x)
          (s :: Sing k) `SCons` ss -&gt; \case
            NS fs -&gt; \case
              NS xs -&gt; NS $ liftA2 (go ss) fs xs
                              \\ (nesting1 s :: Wit (Applicative (v k)))
    {-# INLINE (&lt;*&gt;) #-}

instance Nesting1 Proxy Foldable v =&gt; Foldable (Nested v js) where
    foldMap f = \case
      N&#216; x  -&gt; f x
      NS (xs :: v j (Nested v ks a))
            -&gt; (foldMap . foldMap) f xs
                 \\ (nesting1 Proxy :: Wit (Foldable (v j)))

instance (Nesting1 Proxy Functor v, Nesting1 Proxy Foldable v, Nesting1 Proxy Traversable v) =&gt; Traversable (Nested v js) where
    traverse f = \case
      N&#216; x  -&gt; N&#216; &lt;$&gt; f x
      NS (xs :: v j (Nested v ks a))
            -&gt; NS &lt;$&gt; (traverse . traverse) f xs
                 \\ (nesting1 Proxy :: Wit (Traversable (v j)))

instance (Vec v, SingI js, Nesting1 Proxy Functor v) =&gt; Distributive (Nested v js) where
    distribute
        :: forall f a. Functor f
        =&gt; f (Nested v js a)
        -&gt; Nested v js (f a)
    distribute xs = genNested sing $ \i -&gt; indexNested i &lt;$&gt; xs
    {-# INLINE distribute #-}
    -- distribute = flip go sing
    --   where
    --     go  :: f (Nested v ks a)
    --         -&gt; Sing ks
    --         -&gt; Nested v ks (f a)
    --     go xs = \case
    --       SNil         -&gt; N&#216; $ unScalar &lt;$&gt; xs
    --       s `SCons` ss -&gt; NS . vGen s $ \i -&gt;
    --                         go (fmap (indexNested' (i :&lt; &#216;)) xs) ss

nHead
    :: forall v p j js a. Vec v
    =&gt; p j
    -&gt; Nested v (Succ j ': js) a
    -&gt; Nested v js a
nHead p = \case
  NS xs -&gt; vHead p xs
{-# INLINE nHead #-}

nTail
    :: Vec v
    =&gt; Nested v (Succ j ': js) a
    -&gt; Nested v (j ': js) a
nTail = \case
  NS xs -&gt; NS $ vTail xs
{-# INLINE nTail #-}

unScalar
    :: Nested v '[] a
    -&gt; a
unScalar = \case
  N&#216; x -&gt; x
{-# INLINE unScalar #-}

unNest
    :: Nested v (j ': js) a
    -&gt; v j (Nested v js a)
unNest = \case
  NS xs -&gt; xs
{-# INLINE unNest #-}

unVector
    :: Functor (v j)
    =&gt; Nested v '[j] a
    -&gt; v j a
unVector = \case
    NS xs -&gt; unScalar &lt;$&gt; xs
{-# INLINE unVector #-}

nVector
    :: Functor (v j)
    =&gt; v j a
    -&gt; Nested v '[j] a
nVector = NS . fmap N&#216;
{-# INLINE nVector #-}

genNested
    :: Vec (v :: k -&gt; Type -&gt; Type)
    =&gt; Sing ns
    -&gt; (Prod (IndexN k) ns -&gt; a)
    -&gt; Nested v ns a
genNested s f = getI $ genNestedA s (I . f)
{-# INLINE genNested #-}

genNestedA
    :: (Vec (v :: k -&gt; Type -&gt; Type), Applicative f)
    =&gt; Sing ns
    -&gt; (Prod (IndexN k) ns -&gt; f a)
    -&gt; f (Nested v ns a)
genNestedA = \case
    SNil         -&gt; \f -&gt; N&#216; &lt;$&gt; f &#216;
    s `SCons` ss -&gt; \f -&gt; NS &lt;$&gt; vGenA s (\i -&gt; genNestedA ss (f . (i :&lt;)))

indexNested
    :: Vec (v :: k -&gt; Type -&gt; Type)
    =&gt; Prod (IndexN k) ns
    -&gt; Nested v ns a
    -&gt; a
indexNested = \case
    &#216; -&gt; \case
      N&#216; x  -&gt; x
    i :&lt; is -&gt; \case
      NS xs -&gt; indexNested is (vIndex i xs)
-- indexNested i = unScalar . indexNested' i
--                   \\ appendNil (prodLength i)

indexNested'
    :: Vec (v :: k -&gt; Type -&gt; Type)
    =&gt; Prod (IndexN k) ms
    -&gt; Nested v (ms ++ ns) a
    -&gt; Nested v ns a
indexNested' = \case
    &#216; -&gt; id
    i :&lt; is -&gt; \case
      NS xs -&gt; indexNested' is (vIndex i xs)

joinNested
    :: forall v ns ms a. Nesting1 Proxy Functor v
    =&gt; Nested v ns (Nested v ms a)
    -&gt; Nested v (ns ++ ms) a
joinNested = \case
    N&#216; x  -&gt; x
    NS (xs :: v j (Nested v js (Nested v ms a))) -&gt;
      NS $ fmap joinNested xs
        \\ (nesting1 Proxy :: Wit (Functor (v j)))

unjoinNested
    :: Nesting1 Proxy Functor v
    =&gt; Length ns
    -&gt; Nested v (ns ++ ms) a
    -&gt; Nested v ns (Nested v ms a)
unjoinNested = mapNVecSlices id
{-# INLINE unjoinNested #-}

mapNVecSlices
    :: forall v ns ms a b. Nesting1 Proxy Functor v
    =&gt; (Nested v ms a -&gt; b)
    -&gt; Length ns
    -&gt; Nested v (ns ++ ms) a
    -&gt; Nested v ns b
mapNVecSlices f = \case
    LZ -&gt; N&#216; . f
    LS l -&gt; \case
      NS (xs :: v j (Nested v js a)) -&gt;
        NS $ mapNVecSlices f l &lt;$&gt; xs
          \\ (nesting1 Proxy :: Wit (Functor (v j)))

diagNV'
    :: forall v n ns a. (Vec v, Nesting1 Proxy Functor v)
    =&gt; Sing n
    -&gt; Nested v (n ': n ': ns) a
    -&gt; Nested v (n ': ns) a
diagNV' s = \case
  NS (xs :: v n (Nested v (n ': ns) a)) -&gt; case vUncons s xs of
    UNil          -&gt; NS vEmpty
    UCons (s' :: Sing n')
          (y :: Nested v (n ': ns) a)
          (ys :: v n' (Nested v (n ': ns) a)) -&gt;
      case nesting1 Proxy :: Wit (Functor (v n')) of
        Wit -&gt; case diagNV' s' (NS (nTail &lt;$&gt; ys)) of
          NS zs -&gt; NS $ vCons (nHead s' y) zs

diagNV
    :: (Vec v, Nesting1 Proxy Functor v)
    =&gt; Sing n
    -&gt; Uniform n ms
    -&gt; Nested v (n ': n ': ms) a
    -&gt; Nested v '[n] a
diagNV s = \case
    U&#216;   -&gt; diagNV' s
    US u -&gt; diagNV s u . diagNV' s

itraverseNested
    :: forall k (v :: k -&gt; Type -&gt; Type) (ns :: [k]) a b f. (Applicative f, Vec v)
    =&gt; (Prod (IndexN k) ns -&gt; a -&gt; f b)
    -&gt; Nested v ns a
    -&gt; f (Nested v ns b)
itraverseNested f = \case
    N&#216; x  -&gt; N&#216; &lt;$&gt; f &#216; x
    NS xs -&gt; NS &lt;$&gt; vITraverse (\i -&gt; itraverseNested (\is -&gt; f (i :&lt; is))) xs

gmul'
    :: forall ms os ns v a.
     ( Nesting1 Proxy Functor      v
     , Nesting1 Sing  Applicative  v
     , Nesting1 Proxy Foldable     v
     , Nesting1 Proxy Traversable  v
     , Nesting1 Sing  Distributive v
     , SingI ns
     , SingI (Reverse os)
     , Num a
     , Vec v
     )
    =&gt; Length ms
    -&gt; Length os
    -&gt; Length ns
    -&gt; Nested v (ms         ++ os) a
    -&gt; Nested v (Reverse os ++ ns) a
    -&gt; Nested v (ms         ++ ns) a
gmul' lM lO _ x y = joinNested $ mapNVecSlices f lM x
  where
    f   :: Nested v os a
        -&gt; Nested v ns a
    f = getSum
      . getConst
      -- . itraverseNested (\i x' -&gt; Const . Sum $ fmap (x' *) (indexNested' (prodReverse' i) y))
      . itraverseNested (\i x' -&gt; Const . Sum $ fmap (x' *) (indexNested' (TCP.reverse' i) y))
{-# INLINE gmul' #-}

-- | Transpose by iteratively sequencing/distributing layers
transpose
    :: forall v os a.
     ( Nesting1 Proxy Functor      v
     , Nesting1 Proxy Foldable     v
     , Nesting1 Proxy Traversable  v
     , Nesting1 Sing  Distributive v
     )
    =&gt; Sing os
    -&gt; Nested v os a
    -&gt; Nested v (Reverse os) a
transpose s = transposeHelp (snocProd (singProd s))
{-# INLINE transpose #-}

transposeHelp
    :: forall v os a.
     ( Nesting1 Proxy Functor      v
     , Nesting1 Proxy Foldable     v
     , Nesting1 Proxy Traversable  v
     , Nesting1 Sing  Distributive v
     )
    =&gt; SnocProd Sing os
    -&gt; Nested v os a
    -&gt; Nested v (Reverse os) a
transposeHelp = \case
    &#216;S -&gt; \case
      N&#216; x -&gt; N&#216; x
    (sOs' :: SnocProd Sing os') :&amp; (sO :: Sing o) -&gt;
      (\\ (nesting1 Proxy :: Wit (Functor      (v o)))) $
      (\\ (nesting1 sO    :: Wit (Distributive (v o)))) $ \x -&gt;
        let lOs'  :: Length os'
            lOs'  = snocProdLength sOs'
            x' :: Nested v os' (v o a)
            x' = mapNVecSlices unVector lOs' x
                   \\ appendSnoc lOs' sO
            xT :: Nested v (Reverse os') (v o a)
            xT = transposeHelp sOs' x'
            y :: v o (Nested v (Reverse os') a)
            y = distribute xT
            y' :: Nested v '[o] (Nested v (Reverse os') a)
            y' = nVector y
        in  joinNested y'
              \\ snocReverse lOs' sO

-- | Transpose by populating a new 'Nested' from scratch
transpose'
    :: Vec v
    =&gt; Length os
    -&gt; Sing (Reverse os)
    -&gt; Nested v os a
    -&gt; Nested v (Reverse os) a
transpose' l sR x = genNested sR $ \i -&gt; indexNested (TCP.reverse' i) x
                      \\ reverseReverse l
{-# INLINE transpose' #-}

nIxRows
    :: forall k (v :: k -&gt; Type -&gt; Type) ns ms a b f. (Nesting1 Proxy Functor v, Applicative f, Vec v)
    =&gt; Length ns
    -&gt; (Prod (IndexN k) ns -&gt; Nested v ms a -&gt; f b)
    -&gt; Nested v (ns ++ ms) a
    -&gt; f (Nested v ns b)
nIxRows = \case
    LZ   -&gt; \f -&gt; fmap N&#216; . f &#216;
    LS l -&gt; \f -&gt; \case
      NS (xs :: v j (Nested v js a)) -&gt;
        fmap NS . vITraverse (\i -&gt; nIxRows l (\is ys -&gt; f (i :&lt; is) ys)) $ xs

liftNested
    :: Distributive (Nested v ns)
    =&gt; (TCV.Vec m (TCV.Vec n a -&gt; a))
    -&gt; TCV.Vec n (Nested v ns a)
    -&gt; TCV.Vec m (Nested v ns a)
liftNested f xs = fmap (\g -&gt; TCV.liftVecD g xs) f
{-# INLINE liftNested #-}

</span></pre></body></html>