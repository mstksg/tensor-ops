<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveGeneric              #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts           #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances          #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE GADTs                      #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE InstanceSigs               #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE KindSignatures             #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase                 #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses      #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes                 #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables        #-}</span><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving         #-}</span><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies               #-}</span><span>
</span><a name="line-14"></a><span class="hs-pragma">{-# LANGUAGE TypeInType                 #-}</span><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE TypeOperators              #-}</span><span>
</span><a name="line-16"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances       #-}</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TensorOps</span><span class="hs-operator">.</span><span class="hs-identifier">Backend</span><span class="hs-operator">.</span><span class="hs-identifier">NTensor</span><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensorL"><span class="hs-identifier hs-type">NTensorL</span></a><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensorV"><span class="hs-identifier hs-type">NTensorV</span></a><span>
</span><a name="line-22"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">DeepSeq</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Primitive</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Distributive</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Kind</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.List.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Nested.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Nested</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Proxy</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Singletons</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Singletons</span><span class="hs-operator">.</span><span class="hs-identifier">Prelude</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Length</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Reverse</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Combinator</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Combinator.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Combinator</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Length</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCL</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Length.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Length</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>               </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCL</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Product</span><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCP</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Product.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Product</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>              </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCP</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Sing.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Sing</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Uniform.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Uniform</span></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">Generics</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Statistics</span><span class="hs-operator">.</span><span class="hs-identifier">Distribution</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span><span class="hs-operator">.</span><span class="hs-identifier">MWC</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span>           </span><a href="TensorOps.NatKind.html"><span class="hs-identifier">TensorOps</span><span class="hs-operator">.</span><span class="hs-identifier">NatKind</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span>           </span><a href="TensorOps.Types.html"><span class="hs-identifier">TensorOps</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span class="hs-operator">.</span><span class="hs-identifier">Higher</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span>           </span><a href="Type.Class.Higher.Util.html"><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span class="hs-operator">.</span><span class="hs-identifier">Higher</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span class="hs-operator">.</span><span class="hs-identifier">Witness</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Family</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCV</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.Type.Vector.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>               </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCV</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.Vector.Sized.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span class="hs-operator">.</span><span class="hs-identifier">Sized</span></a><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">VS</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Family</span><span class="hs-operator">.</span><span class="hs-identifier">Nat</span><span>                     </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCN</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-keyword">newtype</span><span> </span><a name="NTensor"><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier">NTensor</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627838321"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1627838321"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-57"></a><span>    </span><a name="NTensor"><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier">NTensor</span></a></a><span>
</span><a name="line-58"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">{</span><span> </span><a name="getNVec"><a href="TensorOps.Backend.NTensor.html#getNVec"><span class="hs-identifier">getNVec</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627838322"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838323"><span class="hs-identifier hs-type">js</span></a><span> </span><a href="#local-1627838324"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-59"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838322"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838324"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838323"><span class="hs-identifier hs-type">js</span></a><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-1627838438"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SingI</span><span> </span><a href="#local-1627838439"><span class="hs-identifier hs-type">ns</span></a><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-1627838440"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-1627838440"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838440"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838438"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838439"><span class="hs-identifier hs-type">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Generic</span><span> </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838435"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838436"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838437"><span class="hs-identifier hs-type">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="#local-1627838432"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nesting"><span class="hs-identifier hs-type">Nesting</span></a><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="#local-1627838433"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838433"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838432"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838434"><span class="hs-identifier hs-type">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="#local-1627838429"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nesting"><span class="hs-identifier hs-type">Nesting</span></a><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="#local-1627838430"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627838431"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838430"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838429"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-66"></a><span>    </span><a name="local-1912934920"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="#local-1627838427"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nesting"><span class="hs-identifier hs-type">Nesting</span></a><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="#local-1627838428"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Type.Class.Higher.Util.html#NFData1"><span class="hs-identifier hs-type">NFData1</span></a><span> </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838428"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838427"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-identifier">genNTensor</span><span>
</span><a name="line-71"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627838365"><a href="#local-1627838365"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627838366"><a href="#local-1627838366"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627838365"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627838367"><a href="#local-1627838367"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-1627838365"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627838368"><a href="#local-1627838368"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><a href="Data.Nested.html#Vec"><span class="hs-identifier hs-type">Vec</span></a><span> </span><a href="#local-1627838366"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-72"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><a href="#local-1627838367"><span class="hs-identifier hs-type">ns</span></a><span>
</span><a name="line-73"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Prod</span><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#IndexN"><span class="hs-identifier hs-type">IndexN</span></a><span> </span><a href="#local-1627838365"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627838367"><span class="hs-identifier hs-type">ns</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627838368"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838366"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838368"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838367"><span class="hs-identifier hs-type">ns</span></a><span>
</span><a name="line-75"></a><a name="genNTensor"><a href="TensorOps.Backend.NTensor.html#genNTensor"><span class="hs-identifier">genNTensor</span></a></a><span> </span><a name="local-1627838369"><a href="#local-1627838369"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627838370"><a href="#local-1627838370"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-var">NTensor</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Nested.html#genNested"><span class="hs-identifier hs-var">genNested</span></a><span> </span><a href="#local-1627838369"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627838370"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-76"></a><span class="hs-pragma">{-# INLINE genNTensor #-}</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-identifier">genNTensorA</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627838360"><a href="#local-1627838360"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627838361"><a href="#local-1627838361"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627838360"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627838362"><a href="#local-1627838362"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-1627838360"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627838363"><a href="#local-1627838363"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><a name="local-1627838364"><a href="#local-1627838364"><span class="hs-identifier">f</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-1627838364"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Vec"><span class="hs-identifier hs-type">Vec</span></a><span> </span><a href="#local-1627838361"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><a href="#local-1627838362"><span class="hs-identifier hs-type">ns</span></a><span>
</span><a name="line-81"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Prod</span><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#IndexN"><span class="hs-identifier hs-type">IndexN</span></a><span> </span><a href="#local-1627838360"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627838362"><span class="hs-identifier hs-type">ns</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627838364"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-1627838363"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627838364"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838361"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838363"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838362"><span class="hs-identifier hs-type">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-83"></a><a name="genNTensorA"><a href="TensorOps.Backend.NTensor.html#genNTensorA"><span class="hs-identifier">genNTensorA</span></a></a><span> </span><a name="local-1627838371"><a href="#local-1627838371"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627838372"><a href="#local-1627838372"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-var">NTensor</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Data.Nested.html#genNestedA"><span class="hs-identifier hs-var">genNestedA</span></a><span> </span><a href="#local-1627838371"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627838372"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-84"></a><span class="hs-pragma">{-# INLINE genNTensorA #-}</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-identifier">indexNTensor</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627838356"><a href="#local-1627838356"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627838357"><a href="#local-1627838357"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627838356"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627838358"><a href="#local-1627838358"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-1627838356"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627838359"><a href="#local-1627838359"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><a href="Data.Nested.html#Vec"><span class="hs-identifier hs-type">Vec</span></a><span> </span><a href="#local-1627838357"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-88"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Prod</span><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#IndexN"><span class="hs-identifier hs-type">IndexN</span></a><span> </span><a href="#local-1627838356"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627838358"><span class="hs-identifier hs-type">ns</span></a><span>
</span><a name="line-89"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838357"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838359"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838358"><span class="hs-identifier hs-type">ns</span></a><span>
</span><a name="line-90"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627838359"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-91"></a><a name="indexNTensor"><a href="TensorOps.Backend.NTensor.html#indexNTensor"><span class="hs-identifier">indexNTensor</span></a></a><span> </span><a name="local-1627838373"><a href="#local-1627838373"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Nested.html#indexNested"><span class="hs-identifier hs-var">indexNested</span></a><span> </span><a href="#local-1627838373"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getNVec</span><span>
</span><a name="line-92"></a><span class="hs-pragma">{-# INLINE indexNTensor #-}</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-identifier">overNVec2</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627838347"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838348"><span class="hs-identifier hs-type">ns</span></a><span> </span><a href="#local-1627838349"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627838350"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627838351"><span class="hs-identifier hs-type">ms</span></a><span> </span><a href="#local-1627838352"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627838353"><span class="hs-identifier hs-type">u</span></a><span> </span><a href="#local-1627838354"><span class="hs-identifier hs-type">os</span></a><span> </span><a href="#local-1627838355"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838347"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838349"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838348"><span class="hs-identifier hs-type">ns</span></a><span>
</span><a name="line-97"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838350"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627838352"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-1627838351"><span class="hs-identifier hs-type">ms</span></a><span>
</span><a name="line-98"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838353"><span class="hs-identifier hs-type">u</span></a><span> </span><a href="#local-1627838355"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-1627838354"><span class="hs-identifier hs-type">os</span></a><span>
</span><a name="line-99"></a><a name="overNVec2"><a href="TensorOps.Backend.NTensor.html#overNVec2"><span class="hs-identifier">overNVec2</span></a></a><span> </span><a name="local-1627838374"><a href="#local-1627838374"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627838375"><a href="#local-1627838375"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627838376"><a href="#local-1627838376"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-var">NTensor</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627838374"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">getNVec</span><span> </span><a href="#local-1627838375"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getNVec</span><span> </span><a href="#local-1627838376"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span class="hs-pragma">{-# INLINE overNVec2 #-}</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-identifier">ntNVec</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-1627838340"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-104"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627838341"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838342"><span class="hs-identifier hs-type">ns</span></a><span> </span><a href="#local-1627838343"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627838340"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627838344"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627838345"><span class="hs-identifier hs-type">ms</span></a><span> </span><a href="#local-1627838346"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838341"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838343"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838342"><span class="hs-identifier hs-type">ns</span></a><span>
</span><a name="line-106"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627838340"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838344"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627838346"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-1627838345"><span class="hs-identifier hs-type">ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-107"></a><a name="ntNVec"><a href="TensorOps.Backend.NTensor.html#ntNVec"><span class="hs-identifier">ntNVec</span></a></a><span> </span><a name="local-1627838377"><a href="#local-1627838377"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-var">NTensor</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627838377"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getNVec</span><span>
</span><a name="line-108"></a><span class="hs-pragma">{-# INLINE ntNVec #-}</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-identifier">nvecNT</span><span>
</span><a name="line-111"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-1627838333"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-112"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838334"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838335"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838336"><span class="hs-identifier hs-type">ns</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627838333"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838337"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627838338"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-1627838339"><span class="hs-identifier hs-type">ms</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627838334"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838336"><span class="hs-identifier hs-type">ns</span></a><span> </span><a href="#local-1627838335"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-114"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627838333"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627838337"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627838339"><span class="hs-identifier hs-type">ms</span></a><span> </span><a href="#local-1627838338"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-115"></a><a name="nvecNT"><a href="TensorOps.Backend.NTensor.html#nvecNT"><span class="hs-identifier">nvecNT</span></a></a><span> </span><a name="local-1627838378"><a href="#local-1627838378"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">getNVec</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627838378"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-var">NTensor</span></a><span>
</span><a name="line-116"></a><span class="hs-pragma">{-# INLINE nvecNT #-}</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-identifier">overNVec</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627838329"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838330"><span class="hs-identifier hs-type">ns</span></a><span> </span><a href="#local-1627838331"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627838329"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838332"><span class="hs-identifier hs-type">ms</span></a><span> </span><a href="#local-1627838331"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838329"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838331"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838330"><span class="hs-identifier hs-type">ns</span></a><span>
</span><a name="line-121"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838329"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838331"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838332"><span class="hs-identifier hs-type">ms</span></a><span>
</span><a name="line-122"></a><a name="overNVec"><a href="TensorOps.Backend.NTensor.html#overNVec"><span class="hs-identifier">overNVec</span></a></a><span> </span><a name="local-1627838379"><a href="#local-1627838379"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getI</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TensorOps.Backend.NTensor.html#ntNVec"><span class="hs-identifier hs-var">ntNVec</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627838379"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span class="hs-pragma">{-# INLINE overNVec #-}</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-identifier">underNVec</span><span>
</span><a name="line-126"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838325"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838326"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838327"><span class="hs-identifier hs-type">ns</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838325"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838326"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838328"><span class="hs-identifier hs-type">ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-127"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627838325"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838327"><span class="hs-identifier hs-type">ns</span></a><span> </span><a href="#local-1627838326"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-128"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627838325"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838328"><span class="hs-identifier hs-type">ms</span></a><span> </span><a href="#local-1627838326"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-129"></a><a name="underNVec"><a href="TensorOps.Backend.NTensor.html#underNVec"><span class="hs-identifier">underNVec</span></a></a><span> </span><a name="local-1627838380"><a href="#local-1627838380"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getNVec</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627838380"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-var">NTensor</span></a><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-keyword">instance</span><span>
</span><a name="line-133"></a><span>      </span><span class="hs-special">(</span><span> </span><a href="Data.Nested.html#Vec"><span class="hs-identifier hs-type">Vec</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627838384"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">RealFloat</span><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-135"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Functor</span><span>      </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-136"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Sing</span><span>  </span><span class="hs-identifier hs-type">Applicative</span><span>  </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-137"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span>     </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-138"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span>  </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-139"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Sing</span><span>  </span><span class="hs-identifier hs-type">Distributive</span><span> </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-140"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq1</span><span> </span><span class="hs-special">(</span><a href="TensorOps.NatKind.html#IndexN"><span class="hs-identifier hs-type">IndexN</span></a><span> </span><a href="#local-1627838384"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TensorOps.Types.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a><span> </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-142"></a><span>    </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">ElemT</span><span>  </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span>    </span><span class="hs-identifier">liftT</span><span>
</span><a name="line-145"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><a name="local-1627838385"><a href="#local-1627838385"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TCN</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">N</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627838386"><a href="#local-1627838386"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-1627838384"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">SingI</span><span> </span><a href="#local-1627838386"><span class="hs-identifier hs-type">o</span></a><span>
</span><a name="line-146"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vec</span><span> </span><a href="#local-1627838385"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vec</span><span> </span><a href="#local-1627838385"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-special">(</span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838386"><span class="hs-identifier hs-type">o</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838386"><span class="hs-identifier hs-type">o</span></a><span>
</span><a name="line-149"></a><span>    </span><a name="local-1912967136"><a href="TensorOps.Types.html#liftT"><span class="hs-identifier">liftT</span></a></a><span> </span><a name="local-1627838408"><a href="#local-1627838408"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-var">NTensor</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Nested.html#liftNested"><span class="hs-identifier hs-var">liftNested</span></a><span> </span><a href="#local-1627838408"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">getNVec</span><span>
</span><a name="line-150"></a><span>    </span><span class="hs-pragma">{-# INLINE liftT #-}</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span>    </span><a name="local-1912967138"><a href="TensorOps.Types.html#sumT"><span class="hs-identifier">sumT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.List.Util.html#sum%27"><span class="hs-identifier hs-var">sum'</span></a><span>
</span><a name="line-153"></a><span>    </span><span class="hs-pragma">{-# INLINE sumT #-}</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span>    </span><a name="local-1912967139"><a href="TensorOps.Types.html#scaleT"><span class="hs-identifier">scaleT</span></a></a><span> </span><a name="local-1627838409"><a href="#local-1627838409"><span class="hs-identifier">&#945;</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TensorOps.Backend.NTensor.html#overNVec"><span class="hs-identifier hs-var">overNVec</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-1627838409"><span class="hs-identifier hs-var">&#945;</span></a><span> </span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>    </span><span class="hs-pragma">{-# INLINE scaleT #-}</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span>    </span><span class="hs-identifier">transp</span><span>
</span><a name="line-159"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627838387"><a href="#local-1627838387"><span class="hs-identifier">ns</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SingI</span><span> </span><a href="#local-1627838387"><span class="hs-identifier hs-type">ns</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SingI</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Reverse</span><span> </span><a href="#local-1627838387"><span class="hs-identifier hs-type">ns</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627838387"><span class="hs-identifier hs-type">ns</span></a><span>
</span><a name="line-161"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Reverse</span><span> </span><a href="#local-1627838387"><span class="hs-identifier hs-type">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span>    </span><span class="hs-comment">-- transp = overNVec (transpose sing)</span><span>
</span><a name="line-163"></a><span>    </span><a name="local-1912967140"><a href="TensorOps.Types.html#transp"><span class="hs-identifier">transp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TensorOps.Backend.NTensor.html#overNVec"><span class="hs-identifier hs-var">overNVec</span></a><span> </span><span class="hs-special">(</span><a href="Data.Nested.html#transpose%27"><span class="hs-identifier hs-var">transpose'</span></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Sing.html#singLength"><span class="hs-identifier hs-var">singLength</span></a><span> </span><span class="hs-identifier hs-var">sing</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">sing</span><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span>    </span><span class="hs-pragma">{-# INLINE transp #-}</span><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span>    </span><span class="hs-identifier">gmul</span><span>
</span><a name="line-167"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627838388"><a href="#local-1627838388"><span class="hs-identifier">ms</span></a></a><span> </span><a name="local-1627838389"><a href="#local-1627838389"><span class="hs-identifier">os</span></a></a><span> </span><a name="local-1627838390"><a href="#local-1627838390"><span class="hs-identifier">ns</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">SingI</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Reverse</span><span> </span><a href="#local-1627838389"><span class="hs-identifier hs-type">os</span></a><span> </span><span class="hs-operator">++</span><span> </span><a href="#local-1627838390"><span class="hs-identifier hs-type">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Length</span><span> </span><a href="#local-1627838388"><span class="hs-identifier hs-type">ms</span></a><span>
</span><a name="line-169"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Length</span><span> </span><a href="#local-1627838389"><span class="hs-identifier hs-type">os</span></a><span>
</span><a name="line-170"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Length</span><span> </span><a href="#local-1627838390"><span class="hs-identifier hs-type">ns</span></a><span>
</span><a name="line-171"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627838388"><span class="hs-identifier hs-type">ms</span></a><span>         </span><span class="hs-operator">++</span><span> </span><a href="#local-1627838389"><span class="hs-identifier hs-type">os</span></a><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Reverse</span><span> </span><a href="#local-1627838389"><span class="hs-identifier hs-type">os</span></a><span> </span><span class="hs-operator">++</span><span> </span><a href="#local-1627838390"><span class="hs-identifier hs-type">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TensorOps.Backend.NTensor.html#NTensor"><span class="hs-identifier hs-type">NTensor</span></a><span> </span><a href="#local-1627838382"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627838383"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627838388"><span class="hs-identifier hs-type">ms</span></a><span>         </span><span class="hs-operator">++</span><span> </span><a href="#local-1627838390"><span class="hs-identifier hs-type">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>    </span><a name="local-1912967137"><a href="TensorOps.Types.html#gmul"><span class="hs-identifier">gmul</span></a></a><span> </span><a name="local-1627838410"><a href="#local-1627838410"><span class="hs-identifier">lM</span></a></a><span> </span><a name="local-1627838411"><a href="#local-1627838411"><span class="hs-identifier">lO</span></a></a><span> </span><a name="local-1627838412"><a href="#local-1627838412"><span class="hs-identifier">lN</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TensorOps.Backend.NTensor.html#overNVec2"><span class="hs-identifier hs-var">overNVec2</span></a><span> </span><span class="hs-special">(</span><a href="Data.Nested.html#gmul%27"><span class="hs-identifier hs-var">gmul'</span></a><span> </span><a href="#local-1627838410"><span class="hs-identifier hs-var">lM</span></a><span> </span><a href="#local-1627838411"><span class="hs-identifier hs-var">lO</span></a><span> </span><a href="#local-1627838412"><span class="hs-identifier hs-var">lN</span></a><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span>                      </span><span class="hs-operator hs-var">\\</span><span> </span><a href="#local-1627838413"><span class="hs-identifier hs-var">sO'</span></a><span>
</span><a name="line-176"></a><span>                      </span><span class="hs-operator hs-var">\\</span><span> </span><a href="#local-1627838414"><span class="hs-identifier hs-var">sN</span></a><span>
</span><a name="line-177"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-178"></a><span>        </span><span class="hs-identifier">sO'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Reverse</span><span> </span><a href="#local-1627838389"><span class="hs-identifier hs-type">os</span></a><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>        </span><span class="hs-identifier">sN</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><a href="#local-1627838390"><span class="hs-identifier hs-type">ns</span></a><span>
</span><a name="line-180"></a><span>        </span><span class="hs-special">(</span><a name="local-1627838413"><a href="#local-1627838413"><span class="hs-identifier">sO'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627838414"><a href="#local-1627838414"><span class="hs-identifier">sN</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Sing.html#splitSing"><span class="hs-identifier hs-var">splitSing</span></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Length.Util.html#reverse%27"><span class="hs-identifier hs-var">TCL</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">reverse'</span></a><span> </span><a href="#local-1627838411"><span class="hs-identifier hs-var">lO</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sing</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Reverse</span><span> </span><a href="#local-1627838389"><span class="hs-identifier hs-type">os</span></a><span> </span><span class="hs-operator">++</span><span> </span><a href="#local-1627838390"><span class="hs-identifier hs-type">ns</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>    </span><span class="hs-pragma">{-# INLINE gmul #-}</span><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span>    </span><span class="hs-comment">-- TODO: this is a dumb implementation</span><span>
</span><a name="line-185"></a><span>    </span><span class="hs-identifier">diag</span><span>
</span><a name="line-186"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627838391"><a href="#local-1627838391"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1627838392"><a href="#local-1627838392"><span class="hs-identifier">ns</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">SingI</span><span> </span><span class="hs-special">(</span><a href="#local-1627838391"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-char">': ns)
        =&gt; Uniform n ns
        -&gt; NTensor v a '[n]
        -&gt; NTensor v a (n ': ns)
    diag u d
        = genNTensor sing (\i -&gt; case TCV.uniformVec (prodToVec I (US u) i) of
                                   Nothing     -&gt; 0
                                   Just (I i') -&gt; indexNTensor (i' :&lt; &#216;) d
                          )
            \\ (produceEq1 :: Eq1 (IndexN k) :- Eq (IndexN k n))
    {-# INLINE diag #-}

    -- TODO: this can be just done using genNTensor
    getDiag
        :: forall n ns. SingI '[n]
        =&gt; Uniform n ns
        -&gt; NTensor v a (n ': n ': ns)
        -&gt; NTensor v a '[n]
    getDiag u = overNVec (diagNV sing u)
                  \\ sHead (sing :: Sing '[n])
    {-# INLINE getDiag #-}

    genRand
        :: forall m d (ns :: [k]). (ContGen d, PrimMonad m, SingI ns)
        =&gt; d
        -&gt; Gen (PrimState m)
        -&gt; m (NTensor v a ns)
    genRand d g = generateA (\_ -&gt; realToFrac &lt;$&gt; genContVar d g)
    {-# INLINE genRand #-}

    generateA
        :: forall f ns. (Applicative f, SingI ns)
        =&gt; (Prod (IndexN k) ns -&gt; f a)
        -&gt; f (NTensor v a ns)
    generateA = genNTensorA sing
    {-# INLINE generateA #-}

    (!) = flip indexNTensor
    {-# INLINE (!) #-}

    ixRows
        :: Applicative f
        =&gt; Length ms
        -&gt; Length os
        -&gt; (Prod (IndexN k) ms -&gt; NTensor v a ns -&gt; f (NTensor v a os))
        -&gt; NTensor v a (ms ++ ns)
        -&gt; f (NTensor v a (ms ++ os))
    ixRows l _ f = ntNVec $ fmap joinNested . nIxRows l (\i -&gt; nvecNT (f i))
    {-# INLINE ixRows #-}

    sumRows
        :: forall n ns. SingI ns
        =&gt; NTensor v a (n ': ns)
        -&gt; NTensor v a ns
    sumRows = overNVec sumRowsNested
                \\ (nesting1 Proxy :: Wit (Foldable (v n)))
    {-# INLINE sumRows #-}

    mapRows
        :: Length ns
        -&gt; (NTensor v a ms -&gt; NTensor v a ms)
        -&gt; NTensor v a (ns ++ ms)
        -&gt; NTensor v a (ns ++ ms)
    mapRows l f = overNVec $ joinNested . mapNVecSlices (underNVec f) l
    {-# INLINE mapRows #-}

type NTensorL = NTensor (Flip2 TCV.VecT   I) Double
type NTensorV = NTensor (Flip2 VS.VectorT I) Double
</span></pre></body></html>